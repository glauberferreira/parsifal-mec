{% extends 'conducting/conducting.html' %}
{% load i18n staticfiles humanize is_visitor %}

{% block javascript %}
  <script type="text/javascript" src="{% static 'js/conducting_data_extraction.js' %}?_=3"></script>
  {% if user|is_visitor:review %}
    <script src="{% static 'js/user_is_visitor.js' %}?v=1"></script>
  {% endif %}
{% endblock javascript %}

{% block tab_content %}
  <div class="modal fade" id="data-extraction-help">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">{% trans 'About Data Extraction' %}</h4>
        </div>
        <div class="modal-body">
          <p>{% trans 'Performs the data extraction for each selected study.' %}</p>
        </div>
      </div>
    </div>
  </div>
  {% include "conducting/conducting_header.html" with active_tab="extraction" %}
  <h3>
    {% trans 'Data Extraction' %}
    <form method="post" action="{% url 'reviews:conducting:export_data_extraction' %}" class="pull-right" style="display: inline-block;">
      {% csrf_token %}
      <input type="hidden" name="review-id" value="{{ review.id }}">

      <button type="submit" class="btn btn-sm btn-default">
        <span class="glyphicon glyphicon-download-alt"></span>
        {% trans 'Export Data' %}
      </button>
    </form>
  </h3>
  <a href="javascript:void(0);" class="pull-right" data-toggle="tooltip" title="{% trans 'What is this? Click to get help.' %}"
      	style="margin-left: 10px;" data-placement="top" data-container="body">
          <span class="glyphicon glyphicon-question-sign" data-toggle="modal" data-target="#data-extraction-help" ></span>
      </a>
  {% include 'comments/comment_icon_button.html' with user=user about="DATA_EXTRACTION" %}

  {% if finished_all_steps %}
    {% csrf_token %}
    <ul class="nav nav-pills" id="data-extraction-menu" style="margin-bottom: 20px;">
      <li{% if tab == 'todo' %} class="active"{% endif %}><a href="?tab=todo">{% trans 'To-do' %}</a></li>
      <li{% if tab == 'done' %} class="active"{% endif %}><a href="?tab=done">{% trans 'Done' %}</a></li>
      <li{% if tab == 'all' %} class="active"{% endif %}><a href="?tab=all">{% trans 'All' %}</a></li>
    </ul>
    <input type="hidden" id="data-extraction-tab" value="{{ tab }}">
    {% if data_extraction_table %}
      {{ data_extraction_table|safe }}
    {% else %}
      {% if tab == 'all' %}
        <h4>{% trans 'No study above the quality cutoff score.' %}</h4>
      {% else %}
        <h4>{% trans 'No data extraction form.' %}</h4>
      {% endif %}
    {% endif %}
  {% else %}
    <p>{% trans 'There are a few steps you have to finish before extract data of the studies:' %}</p>
    <ul>
      {% for message in steps_messages %}
        <li>{{ message|safe }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endblock tab_content %}
